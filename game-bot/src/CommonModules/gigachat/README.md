# Модуль интеграции с GigaChat API

Модуль для работы с GigaChat API от Сбербанка через HTTP запросы в 1C:Enterprise.

## Получение учетных данных

1. Зарегистрируйтесь на портале [GigaChat](https://developers.sber.ru/portal/products/gigachat)
2. Создайте новое приложение в личном кабинете
3. Получите **Client ID** и **Client Secret** для вашего приложения
4. Сохраните эти данные - они понадобятся для авторизации

## Подключение модуля

Модуль уже добавлен в конфигурацию как общий модуль `gigachat`.

### Настройка в 1C

1. Откройте конфигурацию в режиме Конфигуратора
2. Найдите общий модуль `gigachat` в дереве конфигурации
3. Убедитесь, что модуль имеет следующие свойства:
   - **Сервер**: ✓ (включено)
   - **Внешнее соединение**: ✓ (включено)
   - **Клиент (управляемое приложение)**: ✓ (опционально)
   - **Вызов сервера**: (по необходимости)

## Примеры использования

### Пример 1: Простой запрос к GigaChat

```bsl
// Формируем авторизационные данные
ClientID = "ваш_client_id";
ClientSecret = "ваш_client_secret";
АвторизационныеДанные = gigachat.СформироватьАвторизационныеДанные(ClientID, ClientSecret);

// Отправляем сообщение
Сообщение = "Привет! Расскажи анекдот про программистов.";
Результат = gigachat.ОтправитьСообщение(Сообщение, АвторизационныеДанные);

Если Результат.Успех Тогда
    Сообщить("Ответ GigaChat: " + Результат.Ответ);
Иначе
    Сообщить("Ошибка: " + Результат.ТекстОшибки);
КонецЕсли;
```

### Пример 2: Использование с выбором модели

```bsl
// Доступные модели: "GigaChat", "GigaChat-Plus", "GigaChat-Pro"
Модель = "GigaChat-Plus";

Результат = gigachat.ОтправитьСообщение(
    "Напиши короткое стихотворение про осень",
    АвторизационныеДанные,
    Модель
);
```

### Пример 3: Интеграция с Телеграм ботом

```bsl
Процедура ОбработатьСообщениеОтПользователя(Отправитель, ТекстСообщения)
    
    // Получаем авторизационные данные из констант
    ClientID = Константы.GigaChatClientID.Получить();
    ClientSecret = Константы.GigaChatClientSecret.Получить();
    
    АвторизационныеДанные = gigachat.СформироватьАвторизационныеДанные(
        ClientID,
        ClientSecret
    );
    
    // Отправляем сообщение в GigaChat
    Результат = gigachat.ОтправитьСообщение(ТекстСообщения, АвторизационныеДанные);
    
    Если Результат.Успех Тогда
        // Отправляем ответ пользователю в Телеграм
        ИнтеграцияТелеграм.ОтправитьСообщение(Отправитель, Результат.Ответ);
    Иначе
        // Обрабатываем ошибку
        ТекстОшибки = "Извините, произошла ошибка при обработке запроса.";
        ИнтеграцияТелеграм.ОтправитьСообщение(Отправитель, ТекстОшибки);
        
        // Логируем ошибку
        ЗаписьЖурналаРегистрации(
            "GigaChat.Ошибка",
            УровеньЖурналаРегистрации.Ошибка,
            ,
            ,
            Результат.ТекстОшибки
        );
    КонецЕсли;
    
КонецПроцедуры
```

## API функций модуля

### `ОтправитьСообщение()`

Отправляет сообщение в GigaChat и получает ответ.

**Параметры:**
- `Сообщение` (Строка) - текст сообщения для отправки
- `АвторизационныеДанные` (Строка) - закодированные в Base64 данные авторизации
- `Модель` (Строка, необязательный) - название модели (по умолчанию "GigaChat")

**Возвращаемое значение:** Структура с полями:
- `Успех` (Булево) - успешность выполнения запроса
- `Ответ` (Строка) - текст ответа от GigaChat
- `КодОшибки` (Число) - код ошибки (если есть)
- `ТекстОшибки` (Строка) - описание ошибки (если есть)

### `ПолучитьТокенДоступа()`

Получает токен доступа OAuth 2.0 для работы с API.

**Параметры:**
- `АвторизационныеДанные` (Строка) - закодированные данные

**Возвращаемое значение:** Структура с токеном доступа

### `СформироватьАвторизационныеДанные()`

Создает строку авторизационных данных в формате Base64.

**Параметры:**
- `ClientID` (Строка) - Client ID из личного кабинета
- `ClientSecret` (Строка) - Client Secret из личного кабинета

**Возвращаемое значение:** Строка - закодированные данные

### `КодироватьВBase64()`

Кодирует строку в формат Base64.

**Параметры:**
- `Строка` (Строка) - исходная строка

**Возвращаемое значение:** Строка - закодированная строка

## Доступные модели GigaChat

- **GigaChat** - базовая модель (бесплатная для персонального использования)
- **GigaChat-Plus** - расширенная модель с улучшенными возможностями
- **GigaChat-Pro** - профессиональная модель с максимальными возможностями

## Обработка ошибок

Все функции модуля возвращают структуру с полями `Успех`, `КодОшибки` и `ТекстОшибки`.

**Типичные ошибки:**

| Код | Описание | Решение |
|-----|----------|---------|
| 401 | Неверные учетные данные | Проверьте Client ID и Client Secret |
| 403 | Доступ запрещен | Убедитесь, что API включен в личном кабинете |
| 429 | Превышен лимит запросов | Подождите перед следующим запросом |
| 500 | Внутренняя ошибка сервера | Повторите запрос позже |

## Рекомендации

1. **Храните учетные данные безопасно** - используйте константы или защищенное хранилище
2. **Обрабатывайте ошибки** - всегда проверяйте поле `Успех` перед использованием ответа
3. **Соблюдайте лимиты** - не отправляйте слишком много запросов в единицу времени
4. **Логируйте запросы** - записывайте важные события в журнал регистрации
5. **Тестируйте на тестовой базе** - перед использованием в продакшене

## Требования

- 1C:Enterprise 8.3 или выше
- Доступ к интернету для HTTP запросов
- Действующая подписка GigaChat API

## Поддержка и документация

- [Официальная документация GigaChat API](https://developers.sber.ru/docs/ru/gigachat/api/overview)
- [Личный кабинет разработчика](https://developers.sber.ru/portal/products/gigachat)

## Лицензия

Используйте в соответствии с условиями использования GigaChat API.

